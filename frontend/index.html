<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HR Automation System - Dashboard</title>
    <link rel="stylesheet" href="css/styles.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
    <div class="container">
        <!-- Sidebar -->
        <aside class="sidebar">
            <div class="logo">
                <i class="fas fa-users-cog"></i>
                <h2>HR Automation</h2>
            </div>
            <nav class="nav-menu">
                <a href="#" class="nav-item active" data-page="dashboard">
                    <i class="fas fa-chart-line"></i>
                    <span>Dashboard</span>
                </a>
                <a href="#" class="nav-item" data-page="candidates">
                    <i class="fas fa-user-tie"></i>
                    <span>Candidates</span>
                </a>
                <a href="#" class="nav-item" data-page="job-description">
                    <i class="fas fa-file-signature"></i>
                    <span>Job Description</span>
                </a>
                <a href="#" class="nav-item" data-page="analyze">
                    <i class="fas fa-brain"></i>
                    <span>Analyze Resumes</span>
                </a>
                <a href="#" class="nav-item" data-page="notifications">
                    <i class="fas fa-bell"></i>
                    <span>Notifications</span>
                </a>
                <a href="#" class="nav-item" data-page="emails">
                    <i class="fas fa-envelope"></i>
                    <span>Email Analysis</span>
                </a>
                <a href="#" class="nav-item" data-page="settings">
                    <i class="fas fa-cog"></i>
                    <span>Settings</span>
                </a>
            </nav>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Header -->
            <header class="header">
                <div class="header-left">
                    <h1 id="page-title">Dashboard</h1>
                </div>
                <div class="header-right">
                    <button class="btn-icon" id="refresh-btn" title="Refresh">
                        <i class="fas fa-sync-alt"></i>
                    </button>
                    <div class="user-info">
                        <i class="fas fa-user-circle"></i>
                        <span>HR Admin</span>
                    </div>
                </div>
            </header>

            <!-- Dashboard Page -->
            <section id="dashboard-page" class="page active">
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-icon blue">
                            <i class="fas fa-file-alt"></i>
                        </div>
                        <div class="stat-content">
                            <h3 id="total-candidates">0</h3>
                            <p>Total Candidates</p>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon green">
                            <i class="fas fa-check-circle"></i>
                        </div>
                        <div class="stat-content">
                            <h3 id="shortlisted-count">0</h3>
                            <p>Shortlisted</p>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon purple">
                            <i class="fas fa-paper-plane"></i>
                        </div>
                        <div class="stat-content">
                            <h3 id="notified-count">0</h3>
                            <p>Notified</p>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon orange">
                            <i class="fas fa-star"></i>
                        </div>
                        <div class="stat-content">
                            <h3 id="avg-score">0</h3>
                            <p>Average Score</p>
                        </div>
                    </div>
                </div>

                <div class="dashboard-actions">
                    <button class="btn btn-primary" onclick="showPage('analyze')">
                        <i class="fas fa-brain"></i> Analyze Resumes
                    </button>
                    <button class="btn btn-secondary" onclick="showPage('candidates')">
                        <i class="fas fa-users"></i> View Candidates
                    </button>
                    <button class="btn btn-success" onclick="showPage('notifications')">
                        <i class="fas fa-bell"></i> Send Notifications
                    </button>
                </div>

                <div class="recent-activity">
                    <h2>Recent Analysis Jobs</h2>
                    <div id="recent-jobs" class="jobs-list">
                        <p class="no-data">No recent jobs</p>
                    </div>
                </div>
            </section>

            <!-- Candidates Page -->
            <section id="candidates-page" class="page">
                <div class="page-actions">
                    <div class="search-box">
                        <i class="fas fa-search"></i>
                        <input type="text" id="search-candidates" placeholder="Search candidates...">
                    </div>
                    <div class="filter-group">
                        <select id="filter-status">
                            <option value="">All Status</option>
                            <option value="shortlisted">Shortlisted</option>
                            <option value="rejected">Rejected</option>
                            <option value="notified">Notified</option>
                        </select>
                        <select id="filter-score">
                            <option value="">All Scores</option>
                            <option value="80">80+</option>
                            <option value="70">70+</option>
                            <option value="60">60+</option>
                        </select>
                    </div>
                </div>

                <div class="table-container">
                    <table class="candidates-table">
                        <thead>
                            <tr>
                                <th>
                                    <input type="checkbox" id="select-all">
                                </th>
                                <th>Name</th>
                                <th>Email</th>
                                <th>Phone</th>
                                <th>Experience</th>
                                <th>Score</th>
                                <th>Status</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="candidates-tbody">
                            <tr>
                                <td colspan="8" class="no-data">No candidates found</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </section>

            <!-- Job Description Page -->
            <section id="job-description-page" class="page">
                <div class="jd-header">
                    <h2><i class="fas fa-file-signature"></i> Manage Job Description</h2>
                    <p class="subtitle">Create or upload a job description to compare resumes against</p>
                </div>

                <!-- Active JD Display -->
                <div id="active-jd-display" class="active-jd-card" style="display: none;">
                    <div class="active-badge">
                        <i class="fas fa-check-circle"></i> Active
                    </div>
                    <h3 id="active-jd-title">-</h3>
                    <div class="jd-meta">
                        <span><i class="fas fa-calendar"></i> Created: <span id="active-jd-date">-</span></span>
                        <span><i class="fas fa-file"></i> Source: <span id="active-jd-source">-</span></span>
                    </div>
                    <div class="jd-content" id="active-jd-content">-</div>
                </div>

                <div class="jd-tabs">
                    <button class="tab-btn active" onclick="switchJDTab('text')">
                        <i class="fas fa-keyboard"></i> Create from Text
                    </button>
                    <button class="tab-btn" onclick="switchJDTab('pdf')">
                        <i class="fas fa-file-pdf"></i> Upload PDF
                    </button>
                    <button class="tab-btn" onclick="switchJDTab('history')">
                        <i class="fas fa-history"></i> History
                    </button>
                </div>

                <!-- Text Input Tab -->
                <div id="jd-text-tab" class="jd-tab-content active">
                    <div class="jd-form-card">
                        <div class="form-group">
                            <label for="jd-title"><i class="fas fa-heading"></i> Job Title *</label>
                            <input type="text" id="jd-title" class="form-input" placeholder="e.g., Senior Software Engineer" required>
                        </div>
                        
                        <div class="form-group">
                            <label for="jd-description"><i class="fas fa-align-left"></i> Job Description *</label>
                            <textarea id="jd-description" class="form-textarea" rows="8" placeholder="Enter detailed job description including responsibilities, qualifications, and company information..." required></textarea>
                            <small class="form-hint">Be specific about role requirements, responsibilities, and expectations</small>
                        </div>
                        
                        <div class="form-group">
                            <label for="jd-requirements"><i class="fas fa-list-check"></i> Key Requirements</label>
                            <textarea id="jd-requirements" class="form-textarea" rows="6" placeholder="Enter key requirements (skills, experience, education, certifications)..."></textarea>
                            <small class="form-hint">List must-have skills and qualifications</small>
                        </div>
                        
                        <div class="form-actions">
                            <button class="btn btn-secondary" onclick="clearJDForm()">
                                <i class="fas fa-times"></i> Clear
                            </button>
                            <button class="btn btn-primary" onclick="createJDFromText()">
                                <i class="fas fa-save"></i> Save & Activate
                            </button>
                        </div>
                    </div>
                </div>

                <!-- PDF Upload Tab -->
                <div id="jd-pdf-tab" class="jd-tab-content">
                    <div class="jd-form-card">
                        <div class="form-group">
                            <label for="jd-pdf-title"><i class="fas fa-heading"></i> Job Title *</label>
                            <input type="text" id="jd-pdf-title" class="form-input" placeholder="e.g., Senior Software Engineer" required>
                        </div>

                        <div class="jd-upload-area" id="jd-upload-area">
                            <input type="file" id="jd-file-input" accept=".pdf" hidden>
                            <i class="fas fa-file-pdf pdf-icon"></i>
                            <h3>Upload Job Description PDF</h3>
                            <p>Click or drag a PDF file here</p>
                            <button class="btn btn-secondary" onclick="document.getElementById('jd-file-input').click()">
                                <i class="fas fa-folder-open"></i> Select PDF File
                            </button>
                            <small class="form-hint">Maximum file size: 10MB</small>
                        </div>
                        <div id="jd-upload-status" class="upload-status"></div>
                        
                        <div class="form-actions">
                            <button class="btn btn-primary" onclick="uploadJDPDF()" id="jd-upload-btn" disabled>
                                <i class="fas fa-upload"></i> Upload & Activate
                            </button>
                        </div>
                    </div>
                </div>

                <!-- History Tab -->
                <div id="jd-history-tab" class="jd-tab-content">
                    <div class="jd-history-container">
                        <div class="table-container">
                            <table class="data-table">
                                <thead>
                                    <tr>
                                        <th>Title</th>
                                        <th>Created Date</th>
                                        <th>Source</th>
                                        <th>Status</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody id="jd-history-tbody">
                                    <tr>
                                        <td colspan="5" class="no-data">No job descriptions found</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Analyze Page -->
            <section id="analyze-page" class="page">
                <div class="analyze-container">
                    <div class="analyze-card">
                        <div class="card-header">
                            <i class="fas fa-cloud-download-alt"></i>
                            <h3>Sync from Google Drive</h3>
                        </div>
                        <p>Download new resumes from your configured Google Drive folder</p>
                        <button class="btn btn-primary btn-block" onclick="syncDrive()">
                            <i class="fas fa-sync"></i> Sync Drive
                        </button>
                    </div>

                    <div class="analyze-card">
                        <div class="card-header">
                            <i class="fas fa-upload"></i>
                            <h3>Upload Resume</h3>
                        </div>
                        <p>Manually upload resume files (PDF format only)</p>
                        <div class="upload-area" id="upload-area">
                            <input type="file" id="file-input" accept=".pdf" multiple hidden>
                            <i class="fas fa-cloud-upload-alt"></i>
                            <p>Click or drag files here</p>
                            <button class="btn btn-secondary" onclick="document.getElementById('file-input').click()">
                                Select Files
                            </button>
                        </div>
                        <div id="upload-status" class="upload-status"></div>
                    </div>

                    <div class="analyze-card">
                        <div class="card-header">
                            <i class="fas fa-brain"></i>
                            <h3>AI Analysis</h3>
                        </div>
                        <p>Analyze all resumes against the job description using AI</p>
                        <button class="btn btn-success btn-block" onclick="analyzeResumes()">
                            <i class="fas fa-play"></i> Start Analysis
                        </button>
                    </div>
                </div>

                <div id="analysis-progress" class="analysis-progress" style="display: none;">
                    <h3>Analysis in Progress...</h3>
                    <div class="progress-bar">
                        <div class="progress-fill" id="progress-fill"></div>
                    </div>
                    <p id="progress-text">Initializing...</p>
                </div>

                <div id="analysis-results" class="analysis-results" style="display: none;"></div>
            </section>

            <!-- Notifications Page -->
            <section id="notifications-page" class="page">
                <div class="notifications-header">
                    <h2><i class="fas fa-bell"></i> Notifications & Communications</h2>
                    <p class="subtitle">Send interview invitations and appointment letters to candidates</p>
                </div>

                <!-- Notification Tabs -->
                <div class="notification-tabs">
                    <button class="notif-tab-btn active" onclick="switchNotificationTab('interview')">
                        <i class="fas fa-calendar-check"></i> Interview Invitations
                    </button>
                    <button class="notif-tab-btn" onclick="switchNotificationTab('appointment')">
                        <i class="fas fa-file-contract"></i> Appointment Letters
                    </button>
                </div>

                <!-- Interview Invitation Tab -->
                <div id="interview-tab" class="notif-tab-content active">
                    <div class="notification-form">
                        <h3>Send Interview Invitations</h3>
                        <form id="notification-form">
                            <div class="form-group">
                                <label for="interview-date"><i class="fas fa-calendar"></i> Interview Date</label>
                                <input type="text" id="interview-date" class="form-input" value="February 25, 2026" required>
                            </div>
                            <div class="form-group">
                                <label for="interview-time"><i class="fas fa-clock"></i> Interview Time</label>
                                <input type="text" id="interview-time" class="form-input" value="10:30 AM" required>
                            </div>
                            <div class="form-group">
                                <label for="interview-location"><i class="fas fa-map-marker-alt"></i> Location</label>
                                <input type="text" id="interview-location" class="form-input" value="Virtual Zoom Meeting" required>
                            </div>
                            <div class="form-group">
                                <label class="checkbox-label">
                                    <input type="checkbox" id="select-top-10" checked>
                                    <span>Send to top 10 shortlisted candidates</span>
                                </label>
                            </div>
                            <button type="submit" class="btn btn-success btn-block">
                                <i class="fas fa-paper-plane"></i> Send Interview Invitations
                            </button>
                        </form>
                    </div>

                    <div class="notification-preview">
                        <h3>Selected Candidates</h3>
                        <div id="notification-candidates" class="notification-candidates">
                            <p class="no-data">No candidates selected</p>
                        </div>
                    </div>

                    <div id="notification-results" class="notification-results" style="display: none;"></div>
                </div>

                <!-- Appointment Letter Tab -->
                <div id="appointment-tab" class="notif-tab-content">
                    <div class="appointment-container">
                        <div class="appointment-form-card">
                            <h3><i class="fas fa-file-signature"></i> Appointment Letter Details</h3>
                            <form id="appointment-form">
                                <div class="form-row">
                                    <div class="form-group">
                                        <label for="appointment-position"><i class="fas fa-briefcase"></i> Position Title *</label>
                                        <input type="text" id="appointment-position" class="form-input" placeholder="e.g., Senior Software Engineer" required>
                                    </div>
                                    <div class="form-group">
                                        <label for="appointment-department"><i class="fas fa-building"></i> Department</label>
                                        <input type="text" id="appointment-department" class="form-input" placeholder="e.g., Engineering" value="Not Specified">
                                    </div>
                                </div>
                                
                                <div class="form-row">
                                    <div class="form-group">
                                        <label for="appointment-salary"><i class="fas fa-dollar-sign"></i> Basic Salary *</label>
                                        <input type="text" id="appointment-salary" class="form-input" placeholder="e.g., $80,000 per annum" required>
                                    </div>
                                    <div class="form-group">
                                        <label for="appointment-probation"><i class="fas fa-hourglass-half"></i> Probation Period (Months) *</label>
                                        <input type="number" id="appointment-probation" class="form-input" placeholder="e.g., 3" value="3" min="1" max="12" required>
                                    </div>
                                </div>

                                <div class="form-row">
                                    <div class="form-group">
                                        <label for="appointment-start-date"><i class="fas fa-calendar-alt"></i> Joining Date *</label>
                                        <input type="date" id="appointment-start-date" class="form-input" required>
                                    </div>
                                    <div class="form-group" style="display: flex; align-items: flex-end;">
                                        <div style="width: 100%; padding: 0.75rem; background: rgba(79, 70, 229, 0.05); border-radius: 8px; font-size: 0.85rem; color: var(--text-secondary);">
                                            <i class="fas fa-info-circle" style="color: var(--primary-color);"></i>
                                            All fields marked with * are required
                                        </div>
                                    </div>
                                </div>

                                <div class="form-group">
                                    <label class="checkbox-label">
                                        <input type="checkbox" id="select-appointed-candidates">
                                        <span>Send to all shortlisted candidates who haven't received appointment letters</span>
                                    </label>
                                </div>

                                <div class="candidate-selection-info">
                                    <i class="fas fa-info-circle"></i>
                                    <span>You can select specific candidates from the list below, or use the checkbox above to send to all eligible candidates</span>
                                </div>

                                <button type="submit" class="btn btn-primary btn-block">
                                    <i class="fas fa-paper-plane"></i> Send Appointment Letters
                                </button>
                            </form>
                        </div>

                        <div class="appointment-candidates-card">
                            <h3>Select Candidates for Appointment</h3>
                            <div class="search-box" style="margin-bottom: 1rem;">
                                <i class="fas fa-search"></i>
                                <input type="text" id="search-appointment-candidates" placeholder="Search candidates...">
                            </div>
                            <div class="appointment-candidate-list" id="appointment-candidate-list">
                                <p class="no-data">Loading candidates...</p>
                            </div>
                        </div>
                    </div>

                    <div id="appointment-results" class="notification-results" style="display: none;"></div>
                </div>
            </section>

            <!-- Email Analysis Page -->
            <section id="emails-page" class="page">
                <div class="emails-header">
                    <h2><i class="fas fa-envelope"></i> Email Analysis Dashboard</h2>
                    <p class="subtitle">AI-powered email analysis and categorization</p>
                </div>

                <div class="email-stats-grid">
                    <div class="stat-card">
                        <div class="stat-icon blue">
                            <i class="fas fa-inbox"></i>
                        </div>
                        <div class="stat-content">
                            <h3 id="total-emails">0</h3>
                            <p>Total Emails</p>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon red">
                            <i class="fas fa-exclamation-triangle"></i>
                        </div>
                        <div class="stat-content">
                            <h3 id="spam-count">0</h3>
                            <p>Spam Detected</p>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon green">
                            <i class="fas fa-star"></i>
                        </div>
                        <div class="stat-content">
                            <h3 id="important-count">0</h3>
                            <p>Important (80+)</p>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon purple">
                            <i class="fas fa-chart-line"></i>
                        </div>
                        <div class="stat-content">
                            <h3 id="avg-importance">0</h3>
                            <p>Avg Importance Score</p>
                        </div>
                    </div>
                </div>

                <div class="email-filters">
                    <div class="search-box">
                        <i class="fas fa-search"></i>
                        <input type="text" id="search-emails" placeholder="Search emails by subject, sender, or summary...">
                    </div>
                    <div class="filter-group">
                        <select id="filter-flag">
                            <option value="">All Flags</option>
                            <option value="not spam">Not Spam</option>
                            <option value="spam">Spam</option>
                        </select>
                        <select id="filter-type">
                            <option value="">All Types</option>
                            <option value="Office">Office</option>
                            <option value="Personal">Personal</option>
                            <option value="Marketing">Marketing</option>
                            <option value="Transactional">Transactional</option>
                        </select>
                        <select id="filter-intention">
                            <option value="">All Intentions</option>
                            <option value="follow up">Follow Up</option>
                            <option value="scheduling">Scheduling</option>
                            <option value="meeting">Meeting</option>
                            <option value="event">Event</option>
                        </select>
                        <select id="filter-importance">
                            <option value="">All Importance</option>
                            <option value="80">High (80+)</option>
                            <option value="50">Medium (50+)</option>
                            <option value="0">Low (0-49)</option>
                        </select>
                    </div>
                </div>

                <div class="emails-container">
                    <div class="table-container">
                        <table class="emails-table">
                            <thead>
                                <tr>
                                    <th style="width: 50px;">
                                        <input type="checkbox" id="select-all-emails" title="Select All">
                                    </th>
                                    <th style="width: 40px;"><i class="fas fa-flag"></i></th>
                                    <th style="width: 150px;">Date</th>
                                    <th style="width: 200px;">From</th>
                                    <th>Subject</th>
                                    <th style="width: 120px;">Type</th>
                                    <th style="width: 120px;">Intention</th>
                                    <th style="width: 100px;">Importance</th>
                                    <th style="width: 100px;">Actions</th>
                                </tr>
                            </thead>
                            <tbody id="emails-tbody">
                                <tr>
                                    <td colspan="9" class="no-data">
                                        <i class="fas fa-inbox" style="font-size: 3rem; color: var(--text-secondary); margin-bottom: 1rem;"></i>
                                        <p>Loading email analysis...</p>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                    
                    <!-- Bulk Actions Bar -->
                    <div id="bulk-actions-bar" class="bulk-actions-bar" style="display: none;">
                        <div class="bulk-actions-content">
                            <span id="selected-count" class="selected-count">0 selected</span>
                            <div class="bulk-action-buttons">
                                <button class="btn btn-secondary" onclick="updateSelectedFlags('not spam')">
                                    <i class="fas fa-check-circle"></i> Mark as Not Spam
                                </button>
                                <button class="btn btn-danger" onclick="updateSelectedFlags('spam')">
                                    <i class="fas fa-ban"></i> Mark as Spam
                                </button>
                                <button class="btn btn-danger" onclick="removeSelectedEmails()">
                                    <i class="fas fa-trash"></i> Remove Selected
                                </button>
                                <button class="btn btn-secondary" onclick="clearSelection()">
                                    <i class="fas fa-times"></i> Clear Selection
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Email Details Modal -->
            <div id="email-modal" class="email-modal">
                <div class="email-modal-content">
                    <div class="email-modal-header">
                        <h2>Email Details</h2>
                        <span class="email-close">&times;</span>
                    </div>
                    <div class="email-modal-body" id="email-details">
                        <!-- Email details will be inserted here by JavaScript -->
                    </div>
                </div>
            </div>

            <!-- Settings Page -->
            <section id="settings-page" class="page">
                <div class="settings-container">
                    <div class="settings-card">
                        <h3><i class="fas fa-key"></i> API Configuration</h3>
                        <div class="settings-info">
                            <p><strong>OpenAI API:</strong> <span class="status-badge active">Active</span></p>
                            <p><strong>Google Drive API:</strong> <span class="status-badge active">Active</span></p>
                            <p><strong>Email SMTP:</strong> <span class="status-badge active">Active</span></p>
                        </div>
                    </div>

                    <div class="settings-card">
                        <h3><i class="fas fa-sliders-h"></i> Analysis Settings</h3>
                        <div class="form-group">
                            <label>Minimum Score Threshold</label>
                            <input type="number" value="80" min="0" max="100">
                        </div>
                        <div class="form-group">
                            <label>AI Model</label>
                            <select>
                                <option>GPT-4o-mini</option>
                                <option>GPT-4</option>
                            </select>
                        </div>
                    </div>

                    <div class="settings-card">
                        <h3><i class="fas fa-folder"></i> File Paths</h3>
                        <div class="settings-info">
                            <p><strong>Resumes:</strong> data/resumes/</p>
                            <p><strong>Job Description:</strong> data/templates/hiring_post.pdf</p>
                            <p><strong>Reports:</strong> outputs/excel_reports/</p>
                        </div>
                    </div>
                </div>
            </section>
        </main>
    </div>

    <!-- Modal for candidate details -->
    <div id="candidate-modal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <div id="candidate-details"></div>
        </div>
    </div>

    <!-- Loading Overlay -->
    <div id="loading-overlay" class="loading-overlay" style="display: none;">
        <div class="spinner"></div>
        <p>Processing...</p>
    </div>

    <script src="js/app.js"></script>
    <script src="js/emails.js"></script>
</body>
</html>
